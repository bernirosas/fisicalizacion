<!DOCTYPE html>
<meta charset="utf-8">
<div class="my_dataviz-flex">
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/15.1.3/Tone.js"></script>

    <link rel="stylesheet" href="chart.css">

    <!-- Map container -->
    <svg id="my_dataviz" width="1000" height="600"></svg>

    <!-- Modal for country details -->
    <div id="country_modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="country_details"></div>
        </div>
    </div>
    <div class="footer">
      
</div>


<script>
// The svg
var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

// Map and projection
var projection = d3.geoNaturalEarth1()
    .scale(width / 1.6 / Math.PI)
    .translate([width / 2, height / 1.8]);  

var path = d3.geoPath().projection(projection);

// Define color scale for CO2 emissions per capita
var colorScale = d3.scaleSequential(d3.interpolateGreys)
    .domain([0, 20]);

// Map country name differences
var countryNameMap = {
    "USA": "United States",
    "Democratic Republic of the Congo": "Democratic Republic of Congo",
    "Republic of the Congo": "Congo",
    "Republic of Serbia": "Serbia",
    "Greenland" : "Denmark",
    "United Republic of Tanzania": "Tanzania",
    "England": "United Kingdom",
    "Macedonia": "North Macedonia",
    "Czech Republic":"Czechia",
    "Ivory Coast":"Cote d'Ivoire"
};

// Function to normalize country name
function normalizeCountryName(geoJsonName) {
    return countryNameMap[geoJsonName] || geoJsonName;
}


// Close modal function
function closeModal() {
    document.getElementById("country_modal").style.display = "none";
}

// Load world map and CO2 emissions data
d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson", function(worldData) {
  // Filter out Antarctica
  worldData.features = worldData.features.filter(function(d) {
    return d.properties.name !== "Antarctica";
  });

  d3.json("./countries_data_2.json", function(gdpData) {

    // Draw the map
    svg.append("g")
      .selectAll("path")
      .data(worldData.features)
      .enter().append("path")
      .attr("d", path)
      .style("fill", "#fff") // Relleno blanco
      .style("stroke", "#000") // Bordes negros
      .style("cursor", "pointer") // Cambiar el cursor a puntero
      .on("mouseover", function(d) {  // Evento de hover
          var countryName = normalizeCountryName(d.properties.name);
        })
      .append("title")
      .text(function(d) {
        var countryName = normalizeCountryName(d.properties.name);
        var ghgPerCapita = gdpData["ghg_per_capita"][countryName];
        console.log(countryName + ": " + (ghgPerCapita ? ghgPerCapita + " Toneladas de gases de efecto invernadero per cápita" : "No data"))
        return countryName + ": " + (ghgPerCapita ? ghgPerCapita + " Toneladas de gases de efecto invernadero per cápita" : "No data");
      });
  });

});


</script>

